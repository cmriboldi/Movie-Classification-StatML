{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Starting clusters\n",
      "Created clusters   46.35 seconds\n",
      "Have results\n",
      "             0  1\n",
      "0            0  8\n",
      "1            1  8\n",
      "2            2  7\n",
      "3            3  2\n",
      "4            4  9\n",
      "5            5  1\n",
      "6            6  9\n",
      "7            7  4\n",
      "8            8  2\n",
      "9            9  5\n",
      "10          10  3\n",
      "11          11  9\n",
      "12          12  3\n",
      "13          13  5\n",
      "14          14  5\n",
      "15          15  1\n",
      "16          16  2\n",
      "17          17  4\n",
      "18          18  7\n",
      "19          19  8\n",
      "20          20  3\n",
      "21          21  3\n",
      "22          22  1\n",
      "23          23  3\n",
      "24          24  6\n",
      "25          25  3\n",
      "26          26  9\n",
      "27          27  3\n",
      "28          28  5\n",
      "29          29  2\n",
      "...        ... ..\n",
      "685568  685568  2\n",
      "685569  685569  6\n",
      "685570  685570  3\n",
      "685571  685571  4\n",
      "685572  685572  0\n",
      "685573  685573  5\n",
      "685574  685574  5\n",
      "685575  685575  9\n",
      "685576  685576  3\n",
      "685577  685577  5\n",
      "685578  685578  2\n",
      "685579  685579  5\n",
      "685580  685580  4\n",
      "685581  685581  9\n",
      "685582  685582  3\n",
      "685583  685583  1\n",
      "685584  685584  5\n",
      "685585  685585  5\n",
      "685586  685586  3\n",
      "685587  685587  0\n",
      "685588  685588  4\n",
      "685589  685589  3\n",
      "685590  685590  4\n",
      "685591  685591  1\n",
      "685592  685592  4\n",
      "685593  685593  9\n",
      "685594  685594  3\n",
      "685595  685595  6\n",
      "685596  685596  9\n",
      "685597  685597  0\n",
      "\n",
      "[685598 rows x 2 columns]\n"
     ]
    }
   ],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "from tqdm import tqdm_notebook as tqdm\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import sklearn.cluster\n",
    "import seaborn\n",
    "import time\n",
    "\n",
    "def timer():\n",
    "    elapsed_time = (time.time() - start)\n",
    "    return \" {0:.2f}\".format(elapsed_time) + \" seconds\" if elapsed_time <= 120 else \" {0:.2f}\".format(elapsed_time/60) + \" minutes\"\n",
    "\n",
    "my_test = pd.read_csv('output/test_movies_with_genres.dat', '\\t')\n",
    "my_train = pd.read_csv('output/train_movies_with_genres.dat', '\\t')\n",
    "\n",
    "train_data = my_train.drop(my_train.columns[:4], axis=1)\n",
    "\n",
    "start = time.time()\n",
    "M = 10\n",
    "mat_train = train_data.as_matrix()\n",
    "print(\"Starting clusters\")\n",
    "km = sklearn.cluster.KMeans(n_clusters=M)\n",
    "km.fit(mat_train)\n",
    "print(\"Created clusters \", timer())\n",
    "labels = km.labels_\n",
    "results = pd.DataFrame([train_data.index,labels]).T\n",
    "print(\"Have results\")\n",
    "print(results)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "        Unnamed: 0  Unnamed: 0.1  userID  movieID  rating  Adventure  \\\n",
      "0           545379        565353   45356       19     1.5          0   \n",
      "1            27916        545911   43726     4369     0.5          0   \n",
      "19          707233        264117   22198     5480     0.5          0   \n",
      "34          208217        480265   38527      728     1.0          0   \n",
      "39           26832        175557   14895     1028     1.0          0   \n",
      "48           95588        481623   38646      344     1.5          0   \n",
      "91          240666        126556   10674     1391     1.5          0   \n",
      "117         135517        204925   17755     5480     1.5          0   \n",
      "118         649875         98029    8168     8783     1.0          0   \n",
      "125         129633        410171   32512     6952     1.5          0   \n",
      "145         500129        515438   41103     1499     0.5          1   \n",
      "152         123837         82713    7315     2396     1.5          0   \n",
      "165         547945        144121   12028     5400     1.5          0   \n",
      "199         373535        779596   65308       88     1.5          0   \n",
      "208          20180        809287   67924      673     1.0          1   \n",
      "212         639606        246631   20438     1380     1.0          0   \n",
      "216         100073        354683   29202     1009     1.5          1   \n",
      "221         541271        274726   23172    32139     1.5          0   \n",
      "222         370680        639026   51901    26828     1.0          0   \n",
      "236         228889        802743   67363    52460     0.5          1   \n",
      "250         514171        385934   30886     2710     1.5          0   \n",
      "305         701912        399535   31854     2368     1.0          1   \n",
      "316         224474        571743   46441     1274     0.5          1   \n",
      "318         234696        802401   67363     4369     1.0          0   \n",
      "320         455162        183716   15714     2422     1.5          1   \n",
      "333         481222        247048   20438     5546     2.0          0   \n",
      "336         447674         65538    6352     2174     1.5          0   \n",
      "372         592408         95491    8114     3076     1.0          0   \n",
      "378         575978        707958   58895    30825     0.5          0   \n",
      "381         154526        455449   36004     1033     1.0          0   \n",
      "...            ...           ...     ...      ...     ...        ...   \n",
      "685122      583436         87299    7612     4736     1.5          0   \n",
      "685146      768994        792464   66544      882     1.0          0   \n",
      "685148      125686        637462   51707     1608     1.5          0   \n",
      "685149      151530        515393   41103      996     1.5          0   \n",
      "685152      256979        391457   31175     5014     1.5          0   \n",
      "685211      459798         63236    6150     3623     1.0          0   \n",
      "685223      662022        594781   48326     8360     1.5          1   \n",
      "685226       96539        471825   37857     4299     1.5          1   \n",
      "685232      503308        533839   42688     1327     2.0          0   \n",
      "685264      701373        690403   57022     4366     1.5          0   \n",
      "685287      450242        229334   19546     3623     0.5          0   \n",
      "685303      696106        199417   17260     1588     0.5          0   \n",
      "685312      397054        114371    9117     3877     1.0          1   \n",
      "685321      498747         64290    6227    48997     1.0          0   \n",
      "685326      714468        729819   60713     1101     1.0          0   \n",
      "685335      348306        175541   14895      891     0.5          0   \n",
      "685337      300539        709522   59092     1676     1.0          0   \n",
      "685369      472604        256599   21624     4447     1.0          0   \n",
      "685381      343302        482671   38662     4092     2.0          0   \n",
      "685382      711695         14375    1724     1353     1.0          0   \n",
      "685384       32759        731801   60863     5481     1.0          0   \n",
      "685423      176659         95925    8114     4889     1.0          0   \n",
      "685446      314466        526991   41727     3024     2.0          0   \n",
      "685472      334356        612789   50265     2163     1.0          0   \n",
      "685475      647919        598841   48717    46972     0.5          0   \n",
      "685513       37473        780179   65308     2184     1.5          0   \n",
      "685520       55894        720948   60170     4974     0.5          0   \n",
      "685525      267715        820040   69135     1370     1.5          1   \n",
      "685526      449817        521042   41258     6957     1.5          0   \n",
      "685551      548424        826068   69504     5010     0.5          0   \n",
      "\n",
      "        Animation  Children  Comedy  Fantasy  ...    Horror  Mystery  Sci-Fi  \\\n",
      "0               0         0       1        0  ...         0        0       0   \n",
      "1               0         0       0        0  ...         0        0       0   \n",
      "19              0         1       1        0  ...         0        0       0   \n",
      "34              0         0       1        0  ...         0        0       0   \n",
      "39              0         1       1        1  ...         0        0       0   \n",
      "48              0         0       1        0  ...         0        0       0   \n",
      "91              0         0       1        0  ...         0        0       1   \n",
      "117             0         1       1        0  ...         0        0       0   \n",
      "118             0         0       0        0  ...         0        1       0   \n",
      "125             0         0       0        0  ...         1        0       0   \n",
      "145             0         0       0        0  ...         0        0       0   \n",
      "152             0         0       1        0  ...         0        0       0   \n",
      "165             0         0       0        0  ...         0        0       0   \n",
      "199             0         0       1        0  ...         0        0       0   \n",
      "208             1         1       1        1  ...         0        0       1   \n",
      "212             0         0       1        0  ...         0        0       0   \n",
      "216             0         1       0        1  ...         0        0       0   \n",
      "221             0         0       0        0  ...         0        0       0   \n",
      "222             0         1       1        0  ...         0        0       0   \n",
      "236             0         0       0        0  ...         0        0       0   \n",
      "250             0         0       0        0  ...         1        0       0   \n",
      "305             0         0       0        0  ...         0        0       1   \n",
      "316             1         0       0        0  ...         0        0       1   \n",
      "318             0         0       0        0  ...         0        0       0   \n",
      "320             0         0       0        0  ...         0        0       0   \n",
      "333             0         0       0        0  ...         1        0       0   \n",
      "336             0         0       1        1  ...         0        0       0   \n",
      "372             0         0       1        0  ...         0        0       0   \n",
      "378             0         0       1        0  ...         0        0       0   \n",
      "381             1         1       0        0  ...         0        0       0   \n",
      "...           ...       ...     ...      ...  ...       ...      ...     ...   \n",
      "685122          0         0       1        0  ...         0        0       0   \n",
      "685146          0         0       0        0  ...         0        0       0   \n",
      "685148          0         0       0        0  ...         0        0       0   \n",
      "685149          0         0       0        0  ...         0        0       0   \n",
      "685152          0         0       1        0  ...         0        0       0   \n",
      "685211          0         0       0        0  ...         0        0       0   \n",
      "685223          1         1       1        0  ...         0        0       0   \n",
      "685226          0         0       1        0  ...         0        0       0   \n",
      "685232          0         0       0        0  ...         1        0       0   \n",
      "685264          1         1       0        1  ...         0        0       0   \n",
      "685287          0         0       0        0  ...         0        0       0   \n",
      "685303          0         1       1        0  ...         0        0       0   \n",
      "685312          0         0       0        1  ...         0        0       0   \n",
      "685321          0         0       0        0  ...         0        0       0   \n",
      "685326          0         0       0        0  ...         0        0       0   \n",
      "685335          0         0       0        0  ...         1        0       0   \n",
      "685337          0         0       0        0  ...         0        0       1   \n",
      "685369          0         0       1        0  ...         0        0       0   \n",
      "685381          0         0       0        0  ...         0        0       1   \n",
      "685382          0         0       1        0  ...         0        0       0   \n",
      "685384          0         0       1        0  ...         0        0       0   \n",
      "685423          0         0       0        0  ...         0        0       0   \n",
      "685446          0         0       0        0  ...         1        0       1   \n",
      "685472          0         0       1        0  ...         1        0       0   \n",
      "685475          0         0       1        1  ...         0        0       0   \n",
      "685513          0         0       1        0  ...         0        1       0   \n",
      "685520          0         0       1        0  ...         0        0       0   \n",
      "685525          0         0       0        0  ...         0        0       0   \n",
      "685526          0         0       1        0  ...         0        0       0   \n",
      "685551          0         0       0        0  ...         0        0       0   \n",
      "\n",
      "        IMAX  Documentary  War  Musical  Film-Noir  Western  Short  \n",
      "0          0            0    0        0          0        0      0  \n",
      "1          0            0    0        0          0        0      0  \n",
      "19         0            0    0        0          0        0      0  \n",
      "34         0            0    0        0          0        0      0  \n",
      "39         0            0    0        1          0        0      0  \n",
      "48         0            0    0        0          0        0      0  \n",
      "91         0            0    0        0          0        0      0  \n",
      "117        0            0    0        0          0        0      0  \n",
      "118        0            0    0        0          0        0      0  \n",
      "125        0            0    0        0          0        0      0  \n",
      "145        0            0    0        0          0        0      0  \n",
      "152        0            0    0        0          0        0      0  \n",
      "165        0            0    0        0          0        0      0  \n",
      "199        0            0    0        0          0        0      0  \n",
      "208        0            0    0        0          0        0      0  \n",
      "212        0            0    0        1          0        0      0  \n",
      "216        0            0    0        0          0        0      0  \n",
      "221        0            0    0        0          0        0      0  \n",
      "222        0            0    0        0          0        0      0  \n",
      "236        0            0    1        0          0        0      0  \n",
      "250        0            0    0        0          0        0      0  \n",
      "305        0            0    0        0          0        0      0  \n",
      "316        0            0    0        0          0        0      0  \n",
      "318        0            0    0        0          0        0      0  \n",
      "320        0            0    0        0          0        0      0  \n",
      "333        0            0    0        0          0        0      0  \n",
      "336        0            0    0        0          0        0      0  \n",
      "372        0            0    0        0          0        0      0  \n",
      "378        0            0    0        0          0        0      0  \n",
      "381        0            0    0        0          0        0      0  \n",
      "...      ...          ...  ...      ...        ...      ...    ...  \n",
      "685122     0            0    0        0          0        0      0  \n",
      "685146     0            0    0        0          0        0      0  \n",
      "685148     0            0    0        0          0        0      0  \n",
      "685149     0            0    0        0          0        0      0  \n",
      "685152     0            0    0        0          0        0      0  \n",
      "685211     0            0    0        0          0        0      0  \n",
      "685223     0            0    0        1          0        0      0  \n",
      "685226     0            0    0        0          0        0      0  \n",
      "685232     0            0    0        0          0        0      0  \n",
      "685264     0            0    0        0          0        0      0  \n",
      "685287     0            0    0        0          0        0      0  \n",
      "685303     0            0    0        0          0        0      0  \n",
      "685312     0            0    0        0          0        0      0  \n",
      "685321     0            0    0        0          0        0      0  \n",
      "685326     0            0    0        0          0        0      0  \n",
      "685335     0            0    0        0          0        0      0  \n",
      "685337     0            0    1        0          0        0      0  \n",
      "685369     0            0    0        0          0        0      0  \n",
      "685381     0            0    0        0          0        0      0  \n",
      "685382     0            0    0        0          0        0      0  \n",
      "685384     0            0    0        0          0        0      0  \n",
      "685423     0            0    0        0          0        0      0  \n",
      "685446     0            0    0        0          0        0      0  \n",
      "685472     0            0    0        0          0        0      0  \n",
      "685475     0            0    0        0          0        0      0  \n",
      "685513     0            0    0        0          0        0      0  \n",
      "685520     0            0    0        0          0        0      0  \n",
      "685525     0            0    0        0          0        0      0  \n",
      "685526     0            0    0        0          0        0      0  \n",
      "685551     0            0    1        0          0        0      0  \n",
      "\n",
      "[44987 rows x 25 columns]\n"
     ]
    }
   ],
   "source": [
    "results.columns = ['index', 'cluster']\n",
    "\n",
    "print(my_train[results['cluster'] == 8])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda root]",
   "language": "python",
   "name": "conda-root-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.5.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
